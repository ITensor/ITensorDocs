<!DOCTYPE html><HTML lang="en"><head><script charset="utf-8" src="../../../assets/default/multidoc_injector.js" type="text/javascript"></script><script charset="utf-8" type="text/javascript">window.MULTIDOCUMENTER_ROOT_PATH = '/ITensorDocs/'</script><script charset="utf-8" src="../../../assets/default/flexsearch.bundle.js" type="text/javascript"></script><script charset="utf-8" src="../../../assets/default/flexsearch_integration.js" type="text/javascript"></script><meta charset="UTF-8"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><title>Quantum Number Conserving DMRG · ITensorMPS.jl</title><meta content="Quantum Number Conserving DMRG · ITensorMPS.jl" name="title"/><meta content="Quantum Number Conserving DMRG · ITensorMPS.jl" property="og:title"/><meta content="Quantum Number Conserving DMRG · ITensorMPS.jl" property="twitter:title"/><meta content="Documentation for ITensorMPS.jl." name="description"/><meta content="Documentation for ITensorMPS.jl." property="og:description"/><meta content="Documentation for ITensorMPS.jl." property="twitter:description"/><meta content="https://itensor.github.io/ITensorMPS.jl/tutorials/QN_DMRG.html" property="og:url"/><meta content="https://itensor.github.io/ITensorMPS.jl/tutorials/QN_DMRG.html" property="twitter:url"/><link href="https://itensor.github.io/ITensorDocs/ITensorMPS/stable/tutorials/QN_DMRG.html" rel="canonical"/><script data-outdated-warner="" src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script data-main="../assets/documenter.js" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" data-theme-name="catppuccin-mocha" href="../assets/themes/catppuccin-mocha.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="catppuccin-macchiato" href="../assets/themes/catppuccin-macchiato.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="catppuccin-frappe" href="../assets/themes/catppuccin-frappe.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="catppuccin-latte" href="../assets/themes/catppuccin-latte.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="documenter-dark" data-theme-primary-dark="" href="../assets/themes/documenter-dark.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="documenter-light" data-theme-primary="" href="../assets/themes/documenter-light.css" rel="stylesheet" type="text/css"/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/><link href="../../../assets/default/multidoc.css" rel="stylesheet" type="text/css"/><link href="../../../assets/default/flexsearch.css" rel="stylesheet" type="text/css"/></head><body><nav id="multi-page-nav"><a class="brand" href="https://itensor.org"><img alt="home" src="../../../assets/logo-dark.png"/></a><div class="hidden-on-mobile" id="nav-items"><a class="nav-link nav-item" href="../../../Overview/">Home</a><a class="nav-link nav-item" href="../../../ITensors/">ITensors</a><a class="nav-link active nav-item" href="../../">ITensorMPS</a><div class="search nav-item"><input id="search-input" placeholder="Search everywhere..."/><ul class="suggestions hidden" id="search-result-container"></ul><div class="search-keybinding">/</div></div></div><button id="multidoc-toggler"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg></button></nav><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../index.html"><img alt="ITensorMPS.jl logo" src="../assets/logo.png"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../index.html">ITensorMPS.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="DMRG.html">DMRG</a></li><li class="is-active"><a class="tocitem" href="QN_DMRG.html">Quantum Number Conserving DMRG</a></li><li><a class="tocitem" href="MPSTimeEvolution.html">MPS Time Evolution</a></li></ul></li><li><span class="tocitem">Code Examples</span><ul><li><a class="tocitem" href="../examples/MPSandMPO.html">MPS and MPO Examples</a></li><li><a class="tocitem" href="../examples/DMRG.html">DMRG Examples</a></li><li><a class="tocitem" href="../examples/Physics.html">Physics (SiteType) System Examples</a></li></ul></li><li><span class="tocitem">Documentation</span><ul><li><a class="tocitem" href="../MPSandMPO.html">MPS and MPO</a></li><li><a class="tocitem" href="../SiteType.html">SiteType and op, state, val functions</a></li><li><a class="tocitem" href="../IncludedSiteTypes.html">SiteTypes Included with ITensor</a></li><li><input class="collapse-toggle" id="menuitem-4-4" type="checkbox"/><label class="tocitem" for="menuitem-4-4"><span class="docs-label">DMRG</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../DMRG.html">DMRG</a></li><li><a class="tocitem" href="../Sweeps.html">Sweeps</a></li><li><a class="tocitem" href="../ProjMPO.html">ProjMPO</a></li><li><a class="tocitem" href="../ProjMPOSum.html">ProjMPOSum</a></li><li><a class="tocitem" href="../Observer.html">Observer System for DMRG</a></li><li><a class="tocitem" href="../DMRGObserver.html">DMRGObserver</a></li></ul></li><li><a class="tocitem" href="../OpSum.html">OpSum</a></li></ul></li><li><span class="tocitem">Frequently Asked Questions</span><ul><li><a class="tocitem" href="../faq/DMRG.html">DMRG FAQs</a></li><li><a class="tocitem" href="../faq/QN.html">Quantum Number (QN) FAQs</a></li></ul></li><li><a class="tocitem" href="../HDF5FileFormats.html">HDF5 File Formats</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" href="#" id="documenter-sidebar-button"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href="QN_DMRG.html">Quantum Number Conserving DMRG</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="QN_DMRG.html">Quantum Number Conserving DMRG</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ITensor/ITensorMPS.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ITensor/ITensorMPS.jl/blob/main/docs/src/tutorials/QN_DMRG.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" href="#" id="documenter-settings-button" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" href="javascript:;" id="documenter-article-toggle-button" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Quantum-Number-Conserving-DMRG"><a class="docs-heading-anchor" href="#Quantum-Number-Conserving-DMRG">Quantum Number Conserving DMRG</a><a id="Quantum-Number-Conserving-DMRG-1"></a><a class="docs-heading-anchor-permalink" href="#Quantum-Number-Conserving-DMRG" title="Permalink"></a></h1><p>An important technique in DMRG calculations of quantum Hamiltonians is the conservation of <em>quantum numbers</em>. Examples of these are the total number of particles of a model of fermions, or the total of all <span>$S^z$</span> components of a system of spins. Not only can conserving quantum numbers make DMRG calculations run more quickly and use less memory, but it can be important for simulating physical systems with conservation laws and for obtaining ground states in different symmetry sectors. Note that ITensor currently only supports Abelian quantum numbers.</p><h4 id="Necessary-Changes"><a class="docs-heading-anchor" href="#Necessary-Changes">Necessary Changes</a><a id="Necessary-Changes-1"></a><a class="docs-heading-anchor-permalink" href="#Necessary-Changes" title="Permalink"></a></h4><p>Setting up a quantum-number conserving DMRG calculation in ITensor requires only very small changes to a DMRG code. The main changes are:</p><ol><li>using tensor indices (<code>Index</code> objects) which carry quantum number (QN) information to build your Hamiltonian and  initial state</li><li>initializing your MPS to have well-defined total quantum numbers</li></ol><p>Importantly, <em>the total QN of your state throughout the calculation will remain the same as the initial state passed to DMRG</em>. The total QN of your state is not set separately, but determined implicitly from the initial QN of the state when it is first constructed.</p><p>Of course, your Hamiltonian should conserve all of the QN's that you would like to use. If it doesn't, you will get an error when you try to construct it out of the QN-enabled tensor indices.</p><h4 id="Making-the-Changes"><a class="docs-heading-anchor" href="#Making-the-Changes">Making the Changes</a><a id="Making-the-Changes-1"></a><a class="docs-heading-anchor-permalink" href="#Making-the-Changes" title="Permalink"></a></h4><p>Let's see how to make these two changes to the <a href="DMRG.html#dmrg_tutorial">DMRG Tutorial</a> code from the previous section. At the end, we will put together these changes for a complete, working code.</p><p><strong>Change 1: QN Site Indices</strong></p><p>To make change (1), we will change the line</p><pre><code class="language-julia hljs">sites = siteinds("S=1",N)</code></pre><p>by setting the <code>conserve_qns</code> keyword argument to <code>true</code>:</p><pre><code class="language-julia hljs">sites = siteinds("S=1",N; conserve_qns=true)</code></pre><p>Setting <code>conserve_qns=true</code> tells the <code>siteinds</code> function to conserve every possible quantum number associated to the site type (which is <code>"S=1"</code> in this example). For <span>$S=1$</span> spins, this will turn on total-<span>$S^z$</span> conservation. (For other site types that conserve multiple QNs, there are specific keyword arguments available to track just a subset of conservable QNs.) We can check this by printing out some of the site indices, and seeing that the subspaces of each <code>Index</code> are labeled by QN values:</p><pre><code class="language-julia hljs">@show sites[1]
@show sites[2]</code></pre><p>Sample output:</p><pre><code class="nohighlight hljs"> sites[1] = (dim=3|id=794|"S=1,Site,n=1") &lt;Out&gt;
 1: QN("Sz",2) =&gt; 1
 2: QN("Sz",0) =&gt; 1
 3: QN("Sz",-2) =&gt; 1
 sites[2] = (dim=3|id=806|"S=1,Site,n=2") &lt;Out&gt;
 1: QN("Sz",2) =&gt; 1
 2: QN("Sz",0) =&gt; 1
 3: QN("Sz",-2) =&gt; 1</code></pre><p>In the sample output above, note that in addition to the dimension of these indices being 3, each of the three settings of the Index have a unique QN associated to them. The number after the QN on each line is the dimension of that subspace, which is 1 for each subspace of the Index objects above. Note also that <code>"Sz"</code> quantum numbers in ITensor are measured in units of <span>$1/2$</span>, so <code>QN("Sz",2)</code> corresponds to <span>$S^z=1$</span> in conventional physics units.</p><p><strong>Change 2: Initial State</strong></p><p>To make change (2), instead of constructing the initial MPS <code>psi0</code> to be an arbitrary, random MPS, we will make it a specific state with a well-defined total <span>$S^z$</span>. So we will replace the line</p><pre><code class="language-julia hljs">psi0 = random_mps(sites;linkdims=10)</code></pre><p>by the lines</p><pre><code class="language-julia hljs">state = [isodd(n) ? "Up" : "Dn" for n=1:N]
psi0 = MPS(sites,state)</code></pre><p>The first line of the new code above makes an array of strings which alternate between <code>"Up"</code> and <code>"Dn"</code> on odd and even numbered sites. These names <code>"Up"</code> and <code>"Dn"</code> are special values associated to the <code>"S=1"</code> site type which indicate up and down spin values. The second line takes the array of site Index objects <code>sites</code> and the array of strings <code>state</code> and returns an MPS which is a product state (classical, unentangled state) with each site's state given by the strings in the <code>state</code> array. In this example, <code>psi0</code> will be a Neel state with alternating up and down spins, so it will have a total <span>$S^z$</span> of zero. We could check this by computing the quantum-number flux of <code>psi0</code></p><pre><code class="language-julia hljs">@show flux(psi0)
# Output: flux(psi0) = QN("Sz",0)</code></pre><div class="admonition is-info"><header class="admonition-header">Setting Other Total QN Values</header><div class="admonition-body"><p>The above example shows the case of setting a total "Sz" quantum number of zero, since the initial state alternates between "Up" and "Dn" on every site with an even number of sites.</p><p>To obtain other total QN values, just set the initial state to be one which has the total QN you want. To be concrete let's take the example of a system with <code>N=10</code> sites of <span>$S=1$</span> spins.</p><p>For example if you want a total "Sz" of +20 (= <code>QN("Sz",20)</code>) in ITensor units, or <span>$S^z=10$</span> in physical units, for a system with 10 sites, use the initial state:</p><pre><code class="language-julia hljs">state = ["Up" for n=1:N]
psi0 = MPS(sites,state)</code></pre><p>Or to initialize this 10-site system to have a total "Sz" of +16 in ITensor units (<span>$S^z=8$</span> in physical units):</p><pre><code class="language-julia hljs">state = ["Dn","Up","Up","Up","Up","Up","Up","Up","Up","Up"]
psi0 = MPS(sites,state)</code></pre><p>would work (as would any <code>state</code> with one "Dn" and nine "Up"'s in any order). Or you could initialize to a total "Sz" of +18 in ITensor units (<span>$S^z=9$</span> in physical units) as</p><pre><code class="language-julia hljs">state = ["Z0","Up","Up","Up","Up","Up","Up","Up","Up","Up"]
psi0 = MPS(sites,state)</code></pre><p>where "Z0" refers to the <span>$S^z=0$</span> state of a spin-one spin.</p><p>Finally, the same kind of logic as above applies to other physical site types, whether "S=1/2", "Electron", etc.</p></div></div><h4 id="Putting-it-All-Together"><a class="docs-heading-anchor" href="#Putting-it-All-Together">Putting it All Together</a><a id="Putting-it-All-Together-1"></a><a class="docs-heading-anchor-permalink" href="#Putting-it-All-Together" title="Permalink"></a></h4><p>Let's take the <a href="DMRG.html#dmrg_tutorial">DMRG Tutorial</a> code from the previous section and make the changes discussed above, to turn it into a code which conserves the total <span>$S^z$</span> quantum number throughout the DMRG calculation. The resulting code is:</p><pre><code class="language-julia hljs">using ITensors, ITensorMPS
let
  N = 100
  sites = siteinds("S=1",N;conserve_qns=true)

  os = OpSum()
  for j=1:N-1
    os += "Sz",j,"Sz",j+1
    os += 1/2,"S+",j,"S-",j+1
    os += 1/2,"S-",j,"S+",j+1
  end
  H = MPO(os,sites)

  state = [isodd(n) ? "Up" : "Dn" for n=1:N]
  psi0 = MPS(sites,state)
  @show flux(psi0)

  nsweeps = 5
  maxdim = [10,20,100,100,200]
  cutoff = [1E-10]

  energy, psi = dmrg(H,psi0; nsweeps, maxdim, cutoff)

  return
end</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="DMRG.html">« DMRG</a><a class="docs-footer-nextpage" href="MPSTimeEvolution.html">MPS Time Evolution »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label></p><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div><p></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.9.0 on <span class="colophon-date" title="Monday 24 March 2025 15:46">Monday 24 March 2025</span>. Using Julia version 1.11.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></HTML>